#{extends 'main.html' /}
#{set title:'Home' /}

<!-- some javascript funcions -->
<script type="text/javascript" charset="utf-8">


   function rateQuestion(questionId, up){ 
    
    $.post( "@{Posts.rate()}"
        ,{id:questionId,up:up}
        ,function (data){
          //update rating                    
          $("#questionRating").html(data);
                
        },"text/html"); 

  }


   
  function rateAnswer(answerId, up){ 
        
    $.post( "@{Posts.rate()}"
        ,{id:answerId,up:up}
        ,function (data){
          //update rating                    
          $("#answerRating-"+answerId).html(data);
                
        },"text/html"); 

  }

  function rateComment(commentId, up){
  	$.post("@{Posts.rate()}"
  		  	,{id:commentId,up:up}
  		  	,function (data){
  	  		  	//update rating
  	  		  	$("#commentRating").html(data);
		},"text/html");
   }
</script>

<div class="question">    
	<h1 class="title">${q.getTitle()}</h1>		
	<table class="question-table">
	<tr>
	 <td class="vote">		
		  <a href="#" onclick="rateQuestion(${q.getId()},true)">/\</a>
		  <div id="questionScore">${q.getVotation()}</div> 
      <a href="#" onclick="rateQuestion(${q.getId()},false)">\/</a>		
	 </td>
	 <td>		
		  <div class="content">
        ${q.getContent().raw()}
      </div>
      <div class="taglist">
        ${q.getTags()}
      </div>
      <div class="actions">      
        #{if q.ownPost()}
        <a href="@{Questions.delete(q.getId())}">delete</a>
        | <a href="@{Questions.edit(q.getId())}">edit</a>        
        #{/if}    
		  </div>
		  <div class="time">
		    updated: ${q.getTimestamp().since()}
		  </div>
		  <div class="owner">
			  Owner: ${q.getOwner().getName()}
		  </div>
		  <div style="clear:both;"></div>
		  <div class="comments">
        <h3>Comments (${q.getComments().size()})</h3>
        <div class="yourcomment">
            #{form @Questions.addComment(), id:'newQuestionComment' } 
		          Your comment:
              <input type="hidden" id="qId" name="qId" value="${q.getId()}"></input>  
              <input type="text" name="comment" id="comment"></input>              
              <a href="#" onclick="$('#newQuestionComment').submit()">add</a>
            #{/form}          
        </div>
        <div class="comment-list">
	        #{list items:q.getComments(), as:'comment'}
	          <div class="comment-list-item">        
	            <div class="comment">${comment.getContent()} - by <span class="owner"></span>${comment.getOwner().getName()}<span class="timestamp"> Timestamp: ${comment.getTimestamp().format('dd.MM.yyyy hh:mm')}</span></div>      
	            <div class="actions">
	              #{if comment.ownPost()}
	                <a href="@{Comments.edit(comment.getId())}">edit</a>
	              #{/if}
	            </div>
	          </div>
	        #{/list}
        </div>
      </div>
	 </td>
	</tr>	
	</table>
</div><!-- end question -->
<br></br>
<div class="answers">
	<h1 class="title">${q.getAnswers().size()} Answers</h1>
	<table class="answers-table">
	#{list items:q.getAnswers(), as:'answer'}	
	 <tr>
	   <td class="vote">    
      <a href="#" onclick="rateAnswer(${answer.getId()},true)">/\</a>
      <div id="answerRating-${answer.getId()}">${answer.getVotation()}</div> 
      <a href="#" onclick="rateAnswer(${answer.getId()},false)">\/</a>
      #{if answer.isBest()}
         <img src="@{'/public/images/tick.png'}"></img>
      #{/if}   
     </td>	
	   <td>
	    <div class="content">
        ${answer.getContent().raw()}
      </div>      
      <div class="actions">      
        #{if answer.ownPost()}
        <a href="@{Questions.delete(answer.getId())}">delete</a> | 
        <a href="@{Questions.edit(answer.getId())}">edit</a>        
        #{/if}
        #{if q.ownPost()}            
            | <a href="@{Questions.markBestAnswer(q.getId(),answer.getId())}"> 
                  ${answer.isBest() ? 'unmark as best':'mark as best'}
              </a>             
        #{/if}    
      </div>
      <div class="time">
        updated: ${answer.getTimestamp().since()}
      </div>
      <div class="owner">
        Owner: ${answer.getOwner().getName()}
      </div>
      <div style="clear:both;"></div>
      <div class="comments">
        <h3>Comments (${answer.getComments().size()})</h3>
        <div class="yourcomment">
            #{form @Answers.addComment(), id:'newAnswerComment' } 
              Your comment:
              <input type="hidden" id="qId" name="qId" value="${answer.getId()}"></input>  
              <input type="text" name="comment" id="comment"></input>              
              <a href="#" onclick="$('#newAnswerComment').submit()">add</a>
            #{/form}          
        </div>
        <div class="comment-list">
          #{list items:answer.getComments(), as:'comment'}
            <div class="comment-list-item">        
              <div class="comment">${comment.getContent()} - by <span class="owner"></span>${comment.getOwner().getName()}<span class="timestamp"> Timestamp: ${comment.getTimestamp().format('dd.MM.yyyy hh:mm')}</span></div>      
              <div class="actions">
                #{if comment.ownPost()}
                  <a href="@{Comments.edit(comment.getId())}">edit</a>
                #{/if}
              </div>
            </div>
          #{/list}
        </div>
      </div><!-- end comments -->	 
	 </td>	
	 </tr>
	#{/list}	
	</table>
</div><!-- end answers -->
<div class="add-answer">
	<h3>Your Answer</h3>
	#{form @Questions.addAnswer(), id:'addAnswerForm' } 
		<input type="hidden" id="qId" name="qId" value="${q.getId()}"></input>
		<textarea name="answer" cols="60" rows="10"></textarea>
		<br></br>
		<a href="#" onclick="$('#addAnswerForm').submit()">add</a>
	#{/form}
</div>
	
