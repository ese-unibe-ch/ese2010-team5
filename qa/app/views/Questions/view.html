#{extends 'main.html' /}
#{set title:'Home' /}

<!-- some javascript funcions -->
<script type="text/javascript" charset="utf-8">


   function rateQuestion(questionId, up){ 
    
    $.post( "@{Posts.rate()}"
        ,{id:questionId,up:up}
        ,function (data){
          //update rating                    
          $("#questionRating").html(data);
                
        },"text/html"); 

  }


   
  function rateAnswer(answerId, up){ 
        
    $.post( "@{Posts.rate()}"
        ,{id:answerId,up:up}
        ,function (data){
          //update rating                    
          $("#answerRating-"+answerId).html(data);
                
        },"text/html"); 

  }

  function rateComment(commentId, up){
  	$.post("@{Posts.rate()}"
  		  	,{id:commentId,up:up}
  		  	,function (data){
  	  		  	//update rating
  	  		  	$("#commentRating").html(data);
		},"text/html");
   }
</script>


<h1>${q.getTitle()}</h1>
<h2>${q.getContent()}</h2>
<br></br>
<div class="actions">
 <a href="#" onclick="rateQuestion(${q.getId()},true)">rate Up</a> |  
 <a href="#" onclick="rateQuestion(${q.getId()},false)">rate Down</a>
#{if q.ownPost()}
 | <a href="@{Questions.delete(q.getId())}">delete</a> | 
 <a href="@{Questions.edit(q.getId())}">edit</a> |
#{/if}
</div>


<table>

	<tr>
	  <td>Owner:</td><td>${q.getOwner().getName()}</td> 
	</tr>
	<tr>
	  <td>Rating:</td><td>
	    <span id="questionRating">${q.getVotation()}</span>
	  </td> 
	</tr>
	<tr>
	  <td>Created At:</td><td>${q.getTimestamp().format('dd.MM.yyyy hh:mm')}</td>
	</tr>
	<tr>
	  <td><h2>Comments (${q.getComments().size()}):</h2></td>
	  <td>
		<div class="list">
		    #{list items:q.getComments(), as:'comment'}
		      <div class="list-item ${comment_parity}">
		        <div class="details">From: ${comment.getOwner().getName()}</div>          
		        <div class="comment x-large">
		            ${comment.getContent()}
		        </div>        
		        <div class="actions">
		          #{if comment.ownPost()}
		            <a href="@{Comments.edit(comment.getId())}">edit</a>
		          #{/if}
		        </div>
		      </div>
		    #{/list}
		</div>
	  </td>
	</tr>
	<tr>
	  <td>Your Comment:</td><td><div id="actions">
		#{form @Questions.addComment(), id:'addCommentForm' } 
	 	 <input type="hidden" id="cId" name="cId" value="${q.getId()}"></input>  
	 	 <input type="text" name="comment" id="comment"></input>
	  	<br></br>
	 	 <a href="#" onclick="$('#addCommentForm').submit()">add</a>
		#{/form}
	</div></td>
	</tr>
</table>

<br></br>
<h2> Answers (${q.getAnswers().size()})</h2>
<tr>
<td>
<div class="list">
    <!-- answers is sorted so that best answer is at the head -->
    #{list items:answers, as:'answer'}
      <div class="list-item ${answer_parity}">
        <div class="details">From: ${answer.getOwner().getName()}, Rating: <span id="answerRating-${answer.getId()}">${answer.getVotation()}</span></div>          
        <div class="answer x-large">
          #{if answer.isBest()}
            <img src="@{'/public/images/tick.png'}"></img>
          #{/if}
           <h3> ${answer.getContent()}</h3>
        </div>        
        <div class="actions">
          <a href="#" onclick="rateAnswer(${answer.getId()},true)">rate Up</a> |
          <a href="#" onclick="rateAnswer(${answer.getId()},false)">rate Down</a>
          #{if answer.ownPost()}
            | <a href="@{Answers.edit(answer.getId())}">edit</a>            
          #{/if}
          #{if q.ownPost()}            
            | <a href="@{Questions.markBestAnswer(q.getId(),answer.getId())}"> 
              ${answer.isBest() ? 'unmark as best':'mark as best'}
            </a>             
          #{/if}
         
        </div>
      </div>
    
</div>


<td>Comments (${answer.getComments().size()}):</td>
<td>
<div class="list">
    #{list items:answer.getComments(), as:'commentA'}
      <div class="list-item ${comment_parity}">
        <div class="details">From: ${commentA.getOwner().getName()}</div>          
        <div class="commentA x-large">
            ${commentA.getContent()}
        </div>        
        <div class="actions">
          #{if commentA.ownPost()}
            <a href="@{Comments.edit(commentA.getId())}">edit</a>
          #{/if}
        </div>#{/list}
      </div>
   
</div> 
</td>
<td> 
<div id="actions">
Your Comment:
	#{form @Answers.addComment(), id:'addCommentAForm' } 
 	 <input type="hidden" id="aId" name="aId" value="${answer.getId()}"></input>  
 	 <input type="text" name="commentA" id="commentA"></input>
  	<br></br>
 	 <a href="#" onclick="$('#addCommentAForm').submit()">add</a>
	#{/form}
#{/list}
</div></td>
</tr>


<br></br>
<hr></hr>
<br></br>

<div id="actions">
<h3> Your Answer</h3>
#{form @Questions.addAnswer(), id:'addAnswerForm' } 
  <input type="hidden" id="qId" name="qId" value="${q.getId()}"></input>  
  <input type="text" name="answer" id="answer"></input>
  <br></br>
  <a href="#" onclick="$('#addAnswerForm').submit()">add</a>
#{/form}
</div>