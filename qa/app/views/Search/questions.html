#{extends 'main.html' /}
#{set title:'Search Result' /}


<script type="text/javascript">

function filter(tagstring){ 

  var match = ".question-summary";
  
  if(!tagstring){   
    $(match).show();
    return;
  }  
  /*hide all and show those with the specified tags*/
  $(match).hide();
   
  var tags = tagstring.replace(" ",".");
  $(match+"."+tags).show();
  
}

</script>


<div class="subnav">
#{if q}
  <h1>Search Result for "${q}"</h1>
#{/if}
<div class="tabs">  
    <a class="active"  href="#">Questions</a>
    <a class=""  href="@{Search.users(q)}">Users</a>
</div>

</div>
<p>
Filter tags: <input type="text" name="tags" onchange="filter($(this).val());"></input>  
</p>
<br></br>
<div id="questions">
  #{if result.isEmpty()}
    <h2>No questions found ;(</h2>
  #{/if}  
	<div class="question-list">
	    #{list items:result, as:'q' }
	      #{set answers:q.getAnswers().size()/}
	      #{set tags:null/}
	      #{list items:q.getTags(), as:'tag'}
	        #{set tags:(tags?tags+' ':'')+tag /}
	      #{/list} 
	      <div class="question-summary ${tags}">
	        <div class="votes">
	        <div>${q.getVotation()}</div>
	        <div>vote</div>
	        </div>
	        <div class="status ${answers == 0 ? 'unanswered' : 'answered'}">
	          <div>${q.getAnswers().size()}</div>
	          <div>answers</div>
	        </div>        
	        <div class="summary">
	          <h3><a href="@{Questions.view(q.getId())}">${q.getTitle()}</a></h3>
	          <span class="tags">
	          Tags: 
	          #{list items:q.getTags(), as:'tag'}
	            <a class="tag" href="@{Questions.list(tag.getName())}">${tag.getName()}</a>
	          #{/list}
	          </span>
	          <div class="started">
	            <span>${q.getTimestamp().since()}</span>          
	          </div>
	          <div style="clear: both"></div>
	          <div class="user">
	            #{if q.getOwner().getName().equals("ANONYMOUS")}
	          from: ANONYMOUS
	      #{/if}
	      #{else}
	          from: <a href="@{Users.view(q.getOwner().getName())}">${q.getOwner().getName()}</a>
	      #{/else}
	          </div>
	        </div>              
	      </div>       
	    #{/list}
	</div>
</div>